<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Memory Lane — Onboarding</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg1:#fff4ec; --bg2:#fffaf6; --card:#ffffff; --accent:#ff6b6b; --accent2:#6b46c1;
      --muted:#6b6b6b;
    }
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial; background:linear-gradient(180deg,var(--bg1),var(--bg2)); margin:0; color:#111}
    .wrap{max-width:980px;margin:28px auto;padding:20px}
    .header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .logo{display:flex;align-items:center;gap:10px}
    .badge-logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent2),#f59e0b);display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
    h1{margin:0;font-size:20px}
    .subtitle{color:var(--muted);font-size:13px}

    .stage{display:grid;grid-template-columns:1fr 360px;gap:20px;margin-top:18px}
    @media (max-width:880px){ .stage{grid-template-columns:1fr; } .aside{order:2} }

    .card{background:var(--card);border-radius:14px;padding:20px;box-shadow:0 10px 30px rgba(20,20,30,0.06)}
    .question{font-weight:700;font-size:16px;margin-bottom:8px}
    .hint{color:var(--muted);font-size:13px;margin-bottom:12px}

    .progress-wrap{display:flex;align-items:center;gap:12px;margin-bottom:14px}
    .progress-bar{flex:1;background:#f1ece9;height:10px;border-radius:999px;overflow:hidden}
    .progress-fill{height:100%;width:0%;background:linear-gradient(90deg,var(--accent2),#f97316);transition:width .45s cubic-bezier(.2,.9,.2,1)}
    .progress-label{font-size:13px;color:var(--muted);min-width:62px;text-align:right}

    .inputs{margin-top:8px}
    input[type="text"], select, textarea{
      width:100%;padding:12px;border-radius:10px;border:1px solid #efe6e3;font-size:14px;margin-top:8px;
    }
    textarea{resize:vertical}
    .controls{display:flex;justify-content:space-between;gap:10px;margin-top:16px}
    .btn{background:linear-gradient(90deg,var(--accent2),#ef476f);color:#fff;padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700;box-shadow:0 8px 20px rgba(107,70,193,0.18);transition:transform .12s}
    .btn:active{transform:translateY(1px) scale(.996)}

    .ghost{background:transparent;border:1px solid #eee;padding:10px 12px;border-radius:10px;cursor:pointer}
    .small{font-size:13px;color:var(--muted)}

    .badges{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .pill{padding:6px 10px;background:linear-gradient(90deg,#fff,#fff);border-radius:999px;border:1px solid #f3e9f6;font-weight:600;font-size:13px}

    .aside{position:relative}
    .preview{position:sticky;top:24px;padding:18px;border-radius:12px;background:linear-gradient(180deg,#fff,#fffefc);box-shadow:0 8px 30px rgba(0,0,0,0.06)}
    .preview h3{margin:0;font-size:16px}
    .preview .meta{color:var(--muted);font-size:13px;margin-top:6px}
    .preview .anchors{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .anchor-pill{background:linear-gradient(90deg,#fff,#f7f7ff);padding:6px 9px;border-radius:8px;border:1px solid #f0eff8;font-size:13px}
    .share-hint{margin-top:12px;font-size:13px;color:var(--muted)}
    .preview .big-badges{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="logo">
        <div class="badge-logo">ML</div>
        <div>
          <h1>Memory Lane</h1>
          <div class="subtitle">Find people who share your childhood vibe</div>
        </div>
      </div>
      <div class="small">6 questions • 30 seconds</div>
    </div>

    <div class="stage">
      <div>
        <div class="card" id="qCard">
          <div class="progress-wrap">
            <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
            <div class="progress-label" id="progressLabel">1 / 6</div>
          </div>

          <div class="question" id="questionTitle">Which TV show or cartoon defined your childhood?</div>
          <div class="hint">Type a show or pick a popular one</div>

          <div class="inputs" id="inputs">
            <input id="inputText" type="text" placeholder="e.g. Shaktimaan or Tom & Jerry" autocomplete="off" />
            <div class="badges" id="liveBadges" aria-hidden="true"></div>
          </div>

          <div class="controls">
            <button class="ghost" id="prevBtn" disabled>Back</button>
            <div style="display:flex;gap:8px">
              <button class="btn" id="nextBtn">Next →</button>
            </div>
          </div>
        </div>

        <div style="margin-top:12px" class="card small">
          <div style="font-weight:700">Tip</div>
          <div style="margin-top:6px;color:var(--muted)">Answer quickly — you can edit later. Badges unlock as you type and make your card shareable.</div>
        </div>
      </div>

      <aside class="aside">
        <div class="preview card" id="preview">
          <div style="display:flex;align-items:center;justify-content:space-between">
            <div>
              <h3 id="previewName">Your Nostalgia Card</h3>
              <div class="meta" id="previewCity">City: —</div>
            </div>
            <div style="text-align:right">
              <div style="font-weight:700;color:var(--accent2)" id="matchPct">—%</div>
              <div class="small">sample match</div>
            </div>
          </div>

          <div class="anchors" id="previewAnchors"></div>
          <div class="big-badges" id="previewBadges"></div>
          <div class="share-hint">Preview updates live. After submitting you can generate a shareable story card.</div>
        </div>
      </aside>
    </div>
  </div>

<script>
  const questions = [
    { key: 'tv', title: 'Which TV show or cartoon defined your childhood?', placeholder: 'e.g. Shaktimaan or Tom & Jerry' },
    { key: 'snack', title: 'Favorite childhood snack?', placeholder: 'e.g. Parle-G, khatti imli' },
    { key: 'device', title: 'First phone / console you had?', placeholder: 'e.g. Nokia 3310' },
    { key: 'memory', title: 'Short school memory (one line)', placeholder: 'e.g. Rangoli competition' },
    { key: 'decade', title: 'Choose decade vibe', placeholder: '90s / 2000s / 80s / 2010s' , isSelect:true, options:['80s','90s','2000s','2010s']},
    { key: 'extra', title: 'Anything else you\'d like to add? (optional)', placeholder: 'e.g. khatti imli in tiffin' }
  ];

  let state = { name:'', city:'', age_range:'25-34', answers:{} };
  let idx = 0;

  const qTitle = document.getElementById('questionTitle');
  const inputText = document.getElementById('inputText');
  const inputsDiv = document.getElementById('inputs');
  const nextBtn = document.getElementById('nextBtn');
  const prevBtn = document.getElementById('prevBtn');
  const progressFill = document.getElementById('progressFill');
  const progressLabel = document.getElementById('progressLabel');
  const liveBadges = document.getElementById('liveBadges');

  const previewName = document.getElementById('previewName');
  const previewCity = document.getElementById('previewCity');
  const previewAnchors = document.getElementById('previewAnchors');
  const previewBadges = document.getElementById('previewBadges');
  const matchPct = document.getElementById('matchPct');

  renderQuestion();
  function renderQuestion() {
    const q = questions[idx];
    qTitle.textContent = q.title;
    progressLabel.textContent = (idx+1) + ' / ' + questions.length;
    progressFill.style.width = ((idx+1)/questions.length*100)+'%';
    inputsDiv.innerHTML = '';

    if (idx === 0) {
      const nameInput = document.createElement('input'); nameInput.placeholder='Your name (e.g. Divya)'; nameInput.value = state.name || '';
      nameInput.addEventListener('input', (e)=>{ state.name = e.target.value; updatePreview();});
      const cityInput = document.createElement('input'); cityInput.placeholder='City you grew up in'; cityInput.value = state.city || '';
      cityInput.addEventListener('input', (e)=>{ state.city = e.target.value; updatePreview(); });
      inputsDiv.appendChild(nameInput);
      inputsDiv.appendChild(cityInput);
    }

    if (q.isSelect) {
      const sel = document.createElement('select');
      q.options.forEach(o => { const opt = document.createElement('option'); opt.value=o; opt.textContent=o; sel.appendChild(opt)});
      sel.addEventListener('change', e=> { state.answers[q.key]=e.target.value; updateLiveBadges(); updatePreview(); });
      inputsDiv.appendChild(sel);
    } else {
      const it = document.createElement('input');
      it.type='text'; it.id='fieldText'; it.placeholder = q.placeholder || '';
      it.value = state.answers[q.key] || '';
      it.addEventListener('input', (e)=>{ state.answers[q.key]=e.target.value; updateLiveBadges(); updatePreview(); });
      inputsDiv.appendChild(it);
    }

    updateLiveBadges();
    prevBtn.disabled = (idx===0);
  }

  prevBtn.addEventListener('click', ()=> { if (idx>0) { idx--; renderQuestion(); } });

  nextBtn.addEventListener('click', async ()=> {
    const q = questions[idx];
    if (!state.answers[q.key] && !q.isSelect && idx !== questions.length-1) {
      alert('Please answer this question to continue (or type N/A).');
      return;
    }
    if (idx < questions.length -1) {
      idx++; renderQuestion();
    } else {
      if (!state.name) {
        const name = prompt("Enter your name to create the card (will display on preview):","Anonymous");
        state.name = name || 'Anonymous';
      }
      await submitProfile();
    }
  });

  function updateLiveBadges(){
    liveBadges.innerHTML='';
    const badges = computeBadges();
    badges.forEach(b=> {
      const s = document.createElement('div'); s.className='pill'; s.textContent=b;
      liveBadges.appendChild(s);
    });
  }

  function computeBadges(){
    const b = [];
    const a = state.answers;
    if ((a.decade || '').toLowerCase().includes('90')) b.push('90s Kid');
    if ((a.tv || '').toLowerCase().includes('shaktimaan')) b.push('Shaktimaan Fan');
    if ((a.snack || '').toLowerCase().includes('parle')) b.push('Parle-G Lover');
    if ((a.device || '').toLowerCase().includes('nokia')) b.push('Nokia 3310');
    if ((a.extra || '').toLowerCase().includes('khatti') || (a.extra||'').toLowerCase().includes('imli')) b.push('Tamarind Snack');
    return Array.from(new Set(b)).slice(0,4);
  }

  function updatePreview(){
    previewName.textContent = state.name ? state.name + "'s Nostalgia Card" : 'Your Nostalgia Card';
    previewCity.textContent = state.city ? 'City: '+state.city : 'City: —';
    previewAnchors.innerHTML='';
    const anchors = [];
    ['tv','snack','device','memory','decade','extra'].forEach(k=>{
      if (state.answers[k]) anchors.push(state.answers[k]);
    });
    anchors.slice(0,5).forEach(a=>{
      const p = document.createElement('div'); p.className='anchor-pill'; p.textContent = a.length>22? a.slice(0,20)+'…': a;
      previewAnchors.appendChild(p);
    });

    previewBadges.innerHTML='';
    computeBadges().forEach(x=>{
      const d = document.createElement('div'); d.className='pill'; d.textContent=x; previewBadges.appendChild(d);
    });

    const filled = anchors.filter(Boolean).length;
    const pct = Math.min(95, 30 + filled*12 + computeBadges().length*8);
    matchPct.textContent = Math.round(pct) + '%';
  }

  async function submitProfile(){
    nextBtn.disabled = true; nextBtn.textContent='Saving…';
    try {
      const payload = {
        name: state.name || 'Anonymous',
        city: state.city || '',
        age_range: state.age_range || '25-34',
        answers: state.answers
      };
      const resp = await fetch('/api/submit', {
        method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload)
      });
      const j = await resp.json();
      if (j.ok) {
        nextBtn.textContent='Saved ✓';
        setTimeout(()=> { window.location = '/responses.html'; }, 700);
      } else {
        alert('Save failed: '+ (j.error || JSON.stringify(j)));
        nextBtn.disabled=false; nextBtn.textContent='Submit';
      }
    } catch(e) {
      console.error(e);
      alert('Network error — check console');
      nextBtn.disabled=false; nextBtn.textContent='Submit';
    }
  }

  updatePreview();
</script>
</body>
</html>
